<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" /> 
        <link th:href="@{/backend/assets/css/bootstrap.min.css}" href="assets/css/bootstrap.min.css" rel="stylesheet" />
        <link th:href="@{/backend/css/style.css}" rel="stylesheet" href="css/style.css"/>
        <link th:href="@{/backend/assets/css/ace.min.css}"  rel="stylesheet" href="assets/css/ace.min.css" />
        <link th:href="@{/backend/assets/css/font-awesome.min.css}" rel="stylesheet" href="assets/css/font-awesome.min.css" />
        <link th:href="@{/backend/Widget/zTree/css/zTreeStyle/zTreeStyle.css}" rel="stylesheet" href="Widget/zTree/css/zTreeStyle/zTreeStyle.css" type="text/css">
        <link th:href="@{/backend/Widget/icheck/icheck.css}" href="Widget/icheck/icheck.css" rel="stylesheet" type="text/css" />
		<!--[if IE 7]>
		  <link th:href="@{/backend/assets/css/font-awesome-ie7.min.css}" rel="stylesheet" href="assets/css/font-awesome-ie7.min.css" />
		<![endif]-->
        <!--[if lte IE 8]>
		  <link th:href="@{/backend/assets/css/ace-ie.min.css}" rel="stylesheet" href="assets/css/ace-ie.min.css" />
		<![endif]-->
	    <script th:src="@{/backend/js/jquery-1.9.1.min.js}" src="js/jquery-1.9.1.min.js"></script>
        <script th:src="@{/backend/assets/js/bootstrap.min.js}" src="assets/js/bootstrap.min.js"></script>
        <script th:src="@{/backend/assets/js/typeahead-bs2.min.js}" src="assets/js/typeahead-bs2.min.js"></script>
		<!-- page specific plugin scripts -->
		<script th:src="@{/backend/assets/js/jquery.dataTables.min.js}" src="assets/js/jquery.dataTables.min.js"></script>
		<script th:src="@{/backend/assets/js/jquery.dataTables.bootstrap.js}" src="assets/js/jquery.dataTables.bootstrap.js"></script>
        <script th:src="@{/backend/js/H-ui.js}" type="text/javascript" src="js/H-ui.js"></script>
        <script th:src="@{/backend/js/H-ui.admin.js}" type="text/javascript" src="js/H-ui.admin.js"></script>
        <script th:src="@{/backend/assets/layer/layer.js}" src="assets/layer/layer.js" type="text/javascript" ></script>
        <script th:src="@{/backend/assets/laydate/laydate.js}" src="assets/laydate/laydate.js" type="text/javascript"></script>
        <script th:src="@{/backend/Widget/zTree/js/jquery.ztree.all-3.5.min.js}" type="text/javascript" src="Widget/zTree/js/jquery.ztree.all-3.5.min.js"></script>
        <script th:src="@{/backend/js/lrtk.js}" src="js/lrtk.js" type="text/javascript" ></script>
<title>产品列表</title>
</head>
<body>
<div class=" page-content clearfix">
 <div id="products_style">
    <div class="search_style">
      <div class="title_names">搜索查询</div>
      <ul class="search_content clearfix">
       <li><label class="l_f">产品名称</label><input id="name" name="" type="text"  class="text_add" placeholder="输入品牌名称"  style=" width:250px"/></li>
       <li>
          <div class="form-group">
              <label  for="cate">产品类型:</label>
              <select  class="form-control" style="margin-top:-30px; margin-left:100px; width:250px"
                       id="cate" name="cate">
                  <!--<option value ="1">商城</option>-->
                  <!--<option value ="2">首页</option>-->
                  <!--<option selected="selected" value="3">首页轮播图</option>-->
                  <!--<option value="4">注册页面背景图</option>-->
                  <!--<option value="5">登录页面背景图</option>-->
              </select>
          </div>
       </li>
          <li style="width:90px;"><button onclick="queryData();" type="button" class="btn_search et"><i class="icon-search"></i>查询</button></li>
      </ul>
    </div>
     <div class="border clearfix">
       <span class="l_f">
        <a href="add_item.html" title="添加商品" class="btn btn-warning Order_form"><i class="icon-plus"></i>添加商品</a>
        <a href="javascript:void(0);" id="delAll" class="btn btn-danger"><i class="icon-trash"></i>批量删除</a>
       </span>
       <span class="r_f">共：<b>2334</b>件商品</span>
     </div>

     <table
             data-url="/buy/queryItemPage" id="tb" class="table table-bordered table-hover
  		table-stripted table-condensed">
     </table>
     <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" >
         <div class="modal-dialog" style=" width:600px;height:800px;">
             <div class="modal-content">
                 <div class="modal-header">
                     广告详细信息
                     <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                         x
                     </button>
                     <h4 class="modal-title" id="myModalLabel">

                     </h4>
                 </div>
                 <div class="modal-body">
                 </div>
                 <div class="modal-footer">
                     <button type="button" class="btn btn-default" data-dismiss="modal">
                         关闭
                     </button>
                     <!-- <button id="submit" type="button" class="btn btn-primary">
                         提交更改
                     </button> -->
                 </div>
             </div><!-- /.modal-content -->
         </div><!-- /.modal-dialog -->
     </div><!-- /.modal -->
     <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
     <script th:src="@{/backend/assets/js/jquery.min.js}" src="js/jquery.min.js"></script>
     <!-- Include all compiled plugins (below), or include individual files as needed -->
     <script th:src="@{/backend/assets/js/bootstrap.min.js}" src="js/bootstrap.min.js"></script>
     <script  th:src="@{/backend/js/ajaxfileupload.js}"   src="js/ajaxfileupload.js"></script>
     <script th:src="@{/backend/js/bootstrap-table.js}" src="js/bootstrap-table.js"></script>
     <script th:src="@{/backend/js/bootstrap-table-zh-CN.js}" src="js/bootstrap-table-zh-CN.js"></script>
     <script th:inline="javascript">
         /*<![CDATA[*/
         function  getURLPath() {
             var contextPath=[[${#httpServletRequest.getScheme()}]]+"://"+[[${#httpServletRequest.getServerName()}]] + ":"+ [[ ${#httpServletRequest.getServerPort()}]]  + [[${#httpServletRequest.getContextPath()}]] + "/";
             return contextPath;
         }
         var cates;
         var to_update=false;
         var isAll=false;
         var selected=false;
         function queryAllCate(){
             $.ajax({
                 url:getURLPath()+"queryCateList",
                 data:"",
                 dataType:"json",
                 type:"post",
                 success:function(data){
                     cates=data;
                     var options="<option value=''>===全部===</option>";
                     $.each(cates, function(index,item){
                         console.log(item);
                         options+="<option value='"+item.id+"'>"+item.name+"</option>";
                     });

                     $("#cate").html(options);
                 },
                 error:function(){

                 }
             });
         }
         //定义一个是否是修改命令的标示符  默认是不是修改只是查看书籍详细信息
         $("#cate").change(function(){
             sssss.bootstrapTable("refresh");
         });
         $("#name").keyup(function(){
             sssss.bootstrapTable("refresh");
         });
         $(function(){
             queryAllCate();
             queryData();
             $(".et").on("click",function(){
                 //重新请求
                 sssss.bootstrapTable("refresh");
             });
             $("#delAll").click(function(){
                 var ids="";
                 var boxs=$("input:checkbox[name='seleted_id']:checked");
                 if(boxs.length==0){
                     alert("请选择您要删除的内容!");
                 }
                 else{
                     boxs.each(function(){
                         ids+=$(this).val()+"-";
                     });
                     del(ids);
                 }
             });
             $("#selectAll").click(function(){
                 var boxs=$("input:checkbox");
                 if(isAll==true){
                     boxs.each(function(){
                         $(this).prop("checked",false);
                     });
                     isAll=false;
                 }
                 else{
                     boxs.each(function(){
                         $(this).prop("checked",true);
                     });
                     isAll=true;
                 }
             });

         });
         // 默认：假分页 按需显示
         // 真分页:按需提取
         var os="";
         var os1="";
         var sssss="";
         function queryData(){
             sssss = $("#tb").bootstrapTable({
                 pagination:true,
                 toolbar:"#toolbar",//指定工具条 一般指查询框
                 pageSize:10,//每页显示多少条
                 pageList:[3,6,9],//可以修改的每页的条数
                 sidePagination:"server",//服务器端分页
                 queryParamsType:"undefined",//limit:offset+limit undefined:向服务器传输 pageSize+pageNumber
                 queryParams:function(msg){//参数
                     console.log(msg);
                     os = (msg.pageNumber-1)*msg.pageSize;
                     var params = {
                         currentPage:msg.pageNumber,//当前页码
                         pageSize:msg.pageSize,//每页记录数
                         name:$("#name").val(), //参数
                         categoryid:$("#cate").val()
                     };
                     console.log(params);
                     return params;
                 },
                 //所有列的数据展示：
                 columns:[
                     {
                         title:"全选"+"<input type='checkbox' id='selectAll'/>",
                         formatter:function(value,row,index){
                             return "<input name='seleted_id' type='checkbox' value='"+row.id+"' />";
                         }
                     },
                     {
                         title:"编号",
                         formatter:function(value,row,index){
                             //return sssss.bootstrapTable("getPage")+index+1;
                             return os+index+1;
                         }
                     },
                     {
                         field:"id",
                         title:"产品编号"
                     },
                     {
                         field:"title",
                         title:"商品标题",
                         formatter:function(value,row,index){
                             var ops="<a name='"+row.id+"' class='viewItem'  href='javascript:void(0)'>"+value+"</a>";
                             return ops;
                         },
                         align:"center"
                     },{
                         field:"smallImage",
                         title:"商品图片",
                         formatter:function(value,row,index){
                             var ops="<a name='"+row.id+"' class='viewItem'  href='javascript:void(0)'>" +
                                 "<image style='width: 100px; height: 50px ;' src='"+value+ "'/></a>";
                             return ops;
                         },
                         align:"center"
                     },
                     {
                         field:"price",
                         title:"价格"
                     },
                     {
                         field:"dateStr",
                         title:"加入时间"
                     },
                     {
                         field:"status",
                         title:"状态",
                         formatter:function(value,row,index){
                             var val="";
                             if(value=="1")
                                 val="已启用";
                             else{
                                 val="未启用";
                             }
                             return val;
                         }
                     },
                     {
                         field:"id",
                         title:"操作",
                         formatter:function(value,row,index){
                             var ops="<a class='del btn btn-danger' "+
                                 "href='javascript:void(0)' id='"+value+"'>删除</a>&nbsp;&nbsp;"+
                                 "<a id='"+value+"' class='update btn btn-success'"+
                                 "href='javascript:void(0)'>修改</a><button name='"+row.id+"' class='viewItem btn btn-primary'>查看详情</button>";
                             return ops;
                         },
                         align:"center",
                         events:etevents
                     }],
                 //点击一行触发的动作
                 onClickRow:function(row,element,field){
                     console.log(row);
                     console.log(element);
                     console.log(field);
                     if(selected==true){
                         $("input:checkbox[value='"+row['id']+"']").prop("checked",false);
                         selected=false;
                     }
                     else{
                         $("input:checkbox[value='"+row['id']+"']").prop("checked",true);
                         selected=true;
                     }
                     //input:checkbox[name='seleted_id']

                     //alert(element);
                     //alert(field);
                     //var boxs=$("input:checkbox[name='seleted_id']:checked");

                     //alert("点击"+field+"了");
                 }

             });
         }
         $('body').on('click', '.update', function(){
             var a=$(this).attr('id');
             to_update=true;
             showinfo(a);
         });
         $('body').on('click', '.viewDetail', function(){
             var a=$(this).attr('name');
             to_update=false;
             showinfo(a);
         });
         $('body').on('click', '.del', function(){
             var ids=$(this).attr("id")+"-";
             del(ids);
         });
         $('body').on('click', '.viewItem', function(){
             var a=$(this).attr('name');
             window.location.href=getURLPath()+"/introduction.html?itemId="+a;
         });
         window.etevents={
             'click .del':function(event,value,row,index){
                 var ids=$(this).attr("id")+"-";
                 del(ids);
             },
             'click #selectAll':function(event,value,row,index){
                 var boxs=$("input:checkbox");
                 for(var i=0;i<boxs.length;i++){
                     boxs[i].prop("checked",true);
                 }
             },
             'click .viewDetail':function(event,value,row,index){
                 alert("sadasd");
                 showinfo($(this).attr("name"));
             },
             'click .update':function(event,value,row,index){
                 to_update=true;
                 showinfo($(this).attr("id"));
             }
         };
         function del(ids){
             if(confirm("您确定要删除并且清空已选信息吗?")){
                 $.ajax({
                     url:getURLPath()+"item/deleItem",
                     data:"ids="+ids,
                     dataType:"json",
                     type:"post",
                     success:function(data){
                         if(data.result=="1"){
                             window.location.href=getURLPath()+"admin/item_list";
                         }
                         else{
                             alert("删除失败 请稍后再试..");
                         }
                     }

                 });
             }

         }

         function convertStatus(b){
             if(b=='1'){
                 return "上架";
             }
             else{
                 return "下架";
             }

         }
         function showinfo(id){
             $.ajax({
                 url:getURLPath()+"viewItemDetail",
                 data:"itemId="+id,
                 dataType:"json",
                 type:"post",
                 success:function(data){
                     var content=data.result;
                     var html="";
                     if(to_update==true){
                         //不只读 是去更改的 要加上form表单的
                         html+="<form onkeydown='if(event.keyCode==13)return false;' class='form-horizontal' id='form' action='"+getURLPath()+"item/updateItem' method='post'>" +
                             "产品编号:<input readonly='readonly' type='text' name='id' value='"+content.id+"'/><br>"+
                             "产品标题:<textarea required='required'  name='title' value='"+content.title+"'/><br>"+
                             "产品卖点描述:<textarea required='required'  name='sellPoint' value='"+content.sell_point+"'/><br>"+
                             "价格:<input required='required' type='text'  name='sellPoint' value='"+content.price+"'/><br>"+
                             "库存:<input required='required'  type='number' name='sellPoint' value='"+content.num+"'/><br>"+
                             "产品类别：<input readonly='readonly' required   class='form-control' type='text' value='"+content.category_name+"'/><br>" +
                             "创建时间:<input required readonly='readonly'  class='form-control' type='text' value='"+content.dateStr+"'/><br>" +
                             "状态:<input readonly='readonly' required name='status' type='text' class='form-control' value='"+convertStatus(content.status)+"'/><br>"+
                             "<button type='submit' class='btn btn-primary'>提交</button></form>";
                     }
                     else{
                         //只读
                         html+="产品编号:<input readonly='readonly' type='text' name='id' value='"+content.id+"'/><br>"+
                         "产品标题:<textarea required='required' readonly='readonly'  name='title' value='"+content.title+"'/><br>"+
                         "产品卖点描述:<textarea required='required' readonly='readonly'  name='sellPoint' value='"+content.sell_point+"'/><br>"+
                         "价格:<input required='required' type='text' readonly='readonly'  name='sellPoint' value='"+content.price+"'/><br>"+
                         "库存:<input required='required'  type='number' readonly='readonly' name='sellPoint' value='"+content.num+"'/><br>"+
                         "产品类别：<input readonly='readonly' required   class='form-control' type='text' value='"+content.category_name+"'/><br>" +
                         "创建时间:<input required readonly='readonly'  class='form-control' type='text' value='"+content.dateStr+"'/><br>" +
                         "状态:<input readonly='readonly' required name='status' type='text' class='form-control' value='"+convertStatus(content.status)+"'/><br>";
                     }
                     html+="产品效果图<img style='margin-left:20px; width: 400px;  height:200px' src='"+content.smallImage+"'/>";
                     $(".modal-body").html(html);
                     $("#myModal").modal("show");
                     $("button#submit").click(function(){
                         $("#form").submit();
                     });
                     $("#form").keypress(function(event){
                         var keycode = (event.keyCode ? event.keyCode : event.which);
                         if(keycode == "13"){
                             $("button.uploadpic").unbind();
                             $("#pic").attr("disabled","disabled");
                             $("#form").submit();
                         }
                     });
                 },
                 error:function(){

                 }
             });
         }
         /*<![CDATA[*/
     </script>
     <!--产品列表展示-->
 </div>
</div>
